---
import type { ApiResponse } from '../types/api';
import ParticipantDashboard from './svelte/ParticipantDashboard.svelte';

// SSR: Load default participant data server-side
const DEFAULT_PARTICIPANT_ID = '308868';
let participantData: ApiResponse | null = null;

try {
  // Server-side fetch during SSR
  const response = await fetch(`${Astro.url.origin}/api/participant/${DEFAULT_PARTICIPANT_ID}`);
  
  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }
  
  participantData = await response.json();
} catch (err) {
  console.error('Error fetching participant data:', err);
}

// Configuration for client-side JavaScript
const frontendConfig = {
  API_BASE_URL: Astro.url.origin, // Use same origin for API calls
  DEFAULT_PARTICIPANT_ID: DEFAULT_PARTICIPANT_ID
};
---

<ParticipantDashboard 
  client:load
  initialData={participantData}
  apiBaseUrl={frontendConfig.API_BASE_URL}
  defaultParticipantId={frontendConfig.DEFAULT_PARTICIPANT_ID}
/>