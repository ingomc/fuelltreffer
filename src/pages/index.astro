---
import Layout from '../layouts/Layout.astro';
import ParticipantData from '../components/ParticipantData.astro';

// Get team ID from URL parameter or use default
const urlParams = new URLSearchParams(Astro.url.search);
const selectedTeamId = urlParams.get('team') || '308868';

// Liga-Teams basierend auf den Matches von F√ºlltreffer
const ligaTeams = [
  { id: '308863', name: 'VFB Einberg 2' },
  { id: '308864', name: 'ESV Darter' },
  { id: '308865', name: '1. DC DownFillCreek 2' },
  { id: '308866', name: 'DC Fire and Ice' },
  { id: '308867', name: 'LTV Gauerstadt' },
  { id: '308868', name: 'SCO-Darts Team F√ºlltreffer' },
  { id: '308869', name: 'TSG 2005 Bamberg 2' },
  { id: '308870', name: 'Erlauer SV' }
];
---

<Layout 
  title="F√ºlltreffer Dashboard - Dart Team Management" 
  description="Verfolge deine Dart-Matches, Team-Statistiken und Spielerprofil mit dem F√ºlltreffer Dashboard. Integriert mit 2k Software f√ºr aktuelle Liga-Daten."
>
  <!-- Sticky Header mit Team-Auswahl -->
  <div class="sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-12">
        <div class="flex items-center space-x-3">
          <a 
            href="/" 
            class="text-xl font-bold text-blue-600 hover:text-blue-800 transition-colors cursor-pointer"
            title="Zur Startseite"
          >
            üéØF√ºlltreffer
          </a>
        </div>
        
        <!-- Team-Auswahl Dropdown -->
        <div class="relative">
          <div id="team-selector" class="flex items-center">
            <span class="text-sm text-gray-600 mr-2 hidden sm:inline">üèÜ</span>
            <select 
              id="header-team-select" 
              class="text-sm border border-gray-300 rounded-md px-3 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            >
              {ligaTeams.map(team => (
                <option value={team.id} selected={team.id === selectedTeamId}>
                  {team.name}
                </option>
              ))}
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <main class="min-h-screen bg-gray-50">
    <ParticipantData teamId={selectedTeamId} />
  </main>

  <script>
    // Handle team selection change
    document.addEventListener('DOMContentLoaded', () => {
      const select = document.getElementById('header-team-select');
      if (select) {
        select.addEventListener('change', (event) => {
          const selectedTeamId = (event.target as HTMLSelectElement).value;
          if (selectedTeamId) {
            // Navigate to URL with team parameter, preserve existing tab parameter
            const url = new URL(window.location.href);
            url.searchParams.set('team', selectedTeamId);
            // Keep existing tab parameter if present
            window.location.href = url.toString();
          }
        });
      }
    });
  </script>
</Layout>